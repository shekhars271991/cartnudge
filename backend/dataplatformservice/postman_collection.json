{
	"info": {
		"_postman_id": "dataplatform-service-collection",
		"name": "CartNudge Data Platform Service",
		"description": "API collection for CartNudge Data Platform Service - manages event ingestion, feature store, datablocks, pipelines, and deployments for real-time ML feature engineering.\n\n## Architecture\n- **API Server** (port 8010): Handles event ingestion and feature retrieval\n- **Feature Materializer** (port 8011): Kafka → ClickHouse pipeline\n- **Feature Aggregator** (port 8012): ClickHouse → Aerospike aggregation job\n\n## Quick Start\n1. Set `api_key` variable to `proj_yourproject_yoursecret`\n2. Send events via Events > Ingest Event\n3. Wait for processing (~10-15s)\n4. Retrieve features via Feature Store > Get User Features",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8010",
			"type": "string",
			"description": "API Server URL"
		},
		{
			"key": "materializer_url",
			"value": "http://localhost:8011",
			"type": "string",
			"description": "Feature Materializer URL"
		},
		{
			"key": "aggregator_url",
			"value": "http://localhost:8012",
			"type": "string",
			"description": "Feature Aggregator URL"
		},
		{
			"key": "clickhouse_url",
			"value": "http://localhost:8123",
			"type": "string",
			"description": "ClickHouse HTTP URL"
		},
		{
			"key": "api_key",
			"value": "proj_testproject123_testsecret",
			"type": "string",
			"description": "API Key format: proj_{project_id}_{secret}"
		},
		{
			"key": "project_id",
			"value": "testproject123",
			"type": "string"
		},
		{
			"key": "user_id",
			"value": "user_demo_001",
			"type": "string"
		},
		{
			"key": "pipeline_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "datablock_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "bucket_id",
			"value": "",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "Health & Status",
			"description": "Health checks for all platform services",
			"item": [
				{
					"name": "API Server Health",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/health",
							"host": ["{{base_url}}"],
							"path": ["health"]
						},
						"description": "Check API server health"
					}
				},
				{
					"name": "Feature Materializer Health",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{materializer_url}}/health",
							"host": ["{{materializer_url}}"],
							"path": ["health"]
						},
						"description": "Check Feature Materializer (Kafka→ClickHouse) health and stats"
					}
				},
				{
					"name": "Feature Aggregator Health",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{aggregator_url}}/health",
							"host": ["{{aggregator_url}}"],
							"path": ["health"]
						},
						"description": "Check Feature Aggregator (ClickHouse→Aerospike) health and stats"
					}
				},
				{
					"name": "API Root Info",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/",
							"host": ["{{base_url}}"],
							"path": [""]
						},
						"description": "Get API service info"
					}
				}
			]
		},
		{
			"name": "Events",
			"description": "Event ingestion - send events to Kafka for processing",
			"item": [
				{
					"name": "Ingest Event - Cart Add",
					"request": {
						"method": "POST",
						"header": [
							{"key": "Content-Type", "value": "application/json"},
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"event_type\": \"cart.add\",\n    \"topic\": \"cart_events\",\n    \"data\": {\n        \"user_id\": \"{{user_id}}\",\n        \"session_id\": \"sess_demo_001\",\n        \"product_id\": \"PROD-001\",\n        \"quantity\": 2,\n        \"price\": 49.99,\n        \"currency\": \"USD\",\n        \"cart_total\": 99.98\n    }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/events/ingest",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "events", "ingest"]
						},
						"description": "Ingest a cart.add event. This sends the event to Kafka topic 'cart_events'."
					}
				},
				{
					"name": "Ingest Event - Cart Remove",
					"request": {
						"method": "POST",
						"header": [
							{"key": "Content-Type", "value": "application/json"},
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"event_type\": \"cart.remove\",\n    \"topic\": \"cart_events\",\n    \"data\": {\n        \"user_id\": \"{{user_id}}\",\n        \"session_id\": \"sess_demo_001\",\n        \"product_id\": \"PROD-001\",\n        \"quantity\": 1\n    }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/events/ingest",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "events", "ingest"]
						},
						"description": "Ingest a cart.remove event"
					}
				},
				{
					"name": "Ingest Event - Cart Checkout",
					"request": {
						"method": "POST",
						"header": [
							{"key": "Content-Type", "value": "application/json"},
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"event_type\": \"cart.checkout\",\n    \"topic\": \"cart_events\",\n    \"data\": {\n        \"user_id\": \"{{user_id}}\",\n        \"session_id\": \"sess_demo_001\",\n        \"cart_total\": 149.99,\n        \"item_count\": 3\n    }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/events/ingest",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "events", "ingest"]
						},
						"description": "Ingest a cart.checkout event"
					}
				},
				{
					"name": "Ingest Event - Page View",
					"request": {
						"method": "POST",
						"header": [
							{"key": "Content-Type", "value": "application/json"},
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"event_type\": \"page.view\",\n    \"topic\": \"page_events\",\n    \"data\": {\n        \"user_id\": \"{{user_id}}\",\n        \"session_id\": \"sess_demo_001\",\n        \"page_url\": \"/products/PROD-001\",\n        \"page_type\": \"product\",\n        \"product_id\": \"PROD-001\",\n        \"referrer\": \"https://google.com\",\n        \"duration_ms\": 15000\n    }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/events/ingest",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "events", "ingest"]
						},
						"description": "Ingest a page.view event. This sends the event to Kafka topic 'page_events'."
					}
				},
				{
					"name": "Ingest Event - Order Created",
					"request": {
						"method": "POST",
						"header": [
							{"key": "Content-Type", "value": "application/json"},
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"event_type\": \"order.created\",\n    \"topic\": \"order_events\",\n    \"data\": {\n        \"user_id\": \"{{user_id}}\",\n        \"order_id\": \"ORD-001\",\n        \"total_amount\": 149.99,\n        \"currency\": \"USD\",\n        \"status\": \"pending\",\n        \"item_count\": 3,\n        \"payment_method\": \"credit_card\"\n    }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/events/ingest",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "events", "ingest"]
						},
						"description": "Ingest an order.created event. This sends the event to Kafka topic 'order_events'."
					}
				},
				{
					"name": "Ingest Event - User Update",
					"request": {
						"method": "POST",
						"header": [
							{"key": "Content-Type", "value": "application/json"},
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"event_type\": \"user.updated\",\n    \"topic\": \"user_events\",\n    \"data\": {\n        \"user_id\": \"{{user_id}}\",\n        \"email\": \"user@example.com\",\n        \"name\": \"Demo User\",\n        \"signup_date\": \"2024-01-15\",\n        \"preferences\": {\n            \"newsletter\": true,\n            \"notifications\": false\n        }\n    }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/events/ingest",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "events", "ingest"]
						},
						"description": "Ingest a user.updated event. This sends the event to Kafka topic 'user_events'."
					}
				},
				{
					"name": "Ingest Event - Custom",
					"request": {
						"method": "POST",
						"header": [
							{"key": "Content-Type", "value": "application/json"},
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"event_type\": \"custom.my_event\",\n    \"topic\": \"custom_events\",\n    \"data\": {\n        \"user_id\": \"{{user_id}}\",\n        \"custom_field_1\": \"value1\",\n        \"custom_field_2\": 123,\n        \"custom_nested\": {\n            \"nested_field\": \"nested_value\"\n        }\n    }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/events/ingest",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "events", "ingest"]
						},
						"description": "Ingest a custom event. This sends the event to Kafka topic 'custom_events'."
					}
				},
				{
					"name": "Get Available Topics",
					"request": {
						"method": "GET",
						"header": [
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/events/topics",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "events", "topics"]
						},
						"description": "Get list of available Kafka topics for event ingestion"
					}
				}
			]
		},
		{
			"name": "Feature Store",
			"description": "Feature store APIs - retrieve and compute user features from Aerospike.\n\n**Feature Groups:**\n- **cart**: Shopping cart behavior (adds, removes, checkout)\n- **page**: Page view and session data\n- **order**: Purchase history and revenue\n- **engagement**: Computed engagement scores\n- **recency**: Time-based recency features",
			"item": [
				{
					"name": "Feature Groups",
					"description": "APIs for retrieving features organized by groups. Each group is stored independently with its own TTL.",
					"item": [
						{
							"name": "List Available Feature Groups",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/v1/features/groups",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "features", "groups"]
								},
								"description": "Get list of available feature groups with descriptions"
							}
						},
						{
							"name": "Get All Feature Groups for User",
							"request": {
								"method": "GET",
								"header": [
									{"key": "X-API-Key", "value": "{{api_key}}"}
								],
								"url": {
									"raw": "{{base_url}}/api/v1/features/user/{{user_id}}/groups",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "features", "user", "{{user_id}}", "groups"]
								},
								"description": "Get all feature groups (cart, page, order, engagement, recency) for a user. Each group is stored in its own Aerospike set with independent TTL."
							}
						},
						{
							"name": "Get Selected Feature Groups",
							"request": {
								"method": "GET",
								"header": [
									{"key": "X-API-Key", "value": "{{api_key}}"}
								],
								"url": {
									"raw": "{{base_url}}/api/v1/features/user/{{user_id}}/groups?groups=cart,engagement",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "features", "user", "{{user_id}}", "groups"],
									"query": [
										{"key": "groups", "value": "cart,engagement"}
									]
								},
								"description": "Get only specific feature groups for a user (comma-separated)"
							}
						},
						{
							"name": "Get Cart Features",
							"request": {
								"method": "GET",
								"header": [
									{"key": "X-API-Key", "value": "{{api_key}}"}
								],
								"url": {
									"raw": "{{base_url}}/api/v1/features/user/{{user_id}}/groups/cart",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "features", "user", "{{user_id}}", "groups", "cart"]
								},
								"description": "Get cart features only: adds, removes, checkouts, cart values, unique products"
							}
						},
						{
							"name": "Get Page Features",
							"request": {
								"method": "GET",
								"header": [
									{"key": "X-API-Key", "value": "{{api_key}}"}
								],
								"url": {
									"raw": "{{base_url}}/api/v1/features/user/{{user_id}}/groups/page",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "features", "user", "{{user_id}}", "groups", "page"]
								},
								"description": "Get page features only: views, sessions, duration, product views"
							}
						},
						{
							"name": "Get Order Features",
							"request": {
								"method": "GET",
								"header": [
									{"key": "X-API-Key", "value": "{{api_key}}"}
								],
								"url": {
									"raw": "{{base_url}}/api/v1/features/user/{{user_id}}/groups/order",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "features", "user", "{{user_id}}", "groups", "order"]
								},
								"description": "Get order features only: order counts, revenue, AOV, items purchased"
							}
						},
						{
							"name": "Get Engagement Features",
							"request": {
								"method": "GET",
								"header": [
									{"key": "X-API-Key", "value": "{{api_key}}"}
								],
								"url": {
									"raw": "{{base_url}}/api/v1/features/user/{{user_id}}/groups/engagement",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "features", "user", "{{user_id}}", "groups", "engagement"]
								},
								"description": "Get engagement features only: engagement score, cart abandonment rate, conversion ratios"
							}
						},
						{
							"name": "Get Recency Features",
							"request": {
								"method": "GET",
								"header": [
									{"key": "X-API-Key", "value": "{{api_key}}"}
								],
								"url": {
									"raw": "{{base_url}}/api/v1/features/user/{{user_id}}/groups/recency",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "features", "user", "{{user_id}}", "groups", "recency"]
								},
								"description": "Get recency features only: days/hours since last activity, first/last seen"
							}
						},
						{
							"name": "Get Flattened Features (ML-Ready)",
							"request": {
								"method": "GET",
								"header": [
									{"key": "X-API-Key", "value": "{{api_key}}"}
								],
								"url": {
									"raw": "{{base_url}}/api/v1/features/user/{{user_id}}/flat",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "features", "user", "{{user_id}}", "flat"]
								},
								"description": "Get all features flattened into a single dictionary with prefixed names (e.g., cart_adds_7d, page_views_30d). Ideal for ML model inference."
							}
						},
						{
							"name": "Get Flattened Features (Selected Groups)",
							"request": {
								"method": "GET",
								"header": [
									{"key": "X-API-Key", "value": "{{api_key}}"}
								],
								"url": {
									"raw": "{{base_url}}/api/v1/features/user/{{user_id}}/flat?groups=cart,page,engagement",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "features", "user", "{{user_id}}", "flat"],
									"query": [
										{"key": "groups", "value": "cart,page,engagement"}
									]
								},
								"description": "Get flattened features for only selected groups"
							}
						}
					]
				},
				{
					"name": "Legacy (Single Blob)",
					"description": "Legacy APIs that return all features in a single response",
					"item": [
						{
							"name": "Get Feature Definitions",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/v1/features/definitions",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "features", "definitions"]
								},
								"description": "Get all feature definitions with descriptions and computation logic"
							}
						},
						{
							"name": "Get User Features (Legacy)",
							"request": {
								"method": "GET",
								"header": [
									{"key": "X-API-Key", "value": "{{api_key}}"}
								],
								"url": {
									"raw": "{{base_url}}/api/v1/features/user/{{user_id}}",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "features", "user", "{{user_id}}"]
								},
								"description": "Get precomputed features for a user (legacy single-blob format). Prefer using /groups endpoints."
							}
						},
						{
							"name": "Get User Feature Summary",
							"request": {
								"method": "GET",
								"header": [
									{"key": "X-API-Key", "value": "{{api_key}}"}
								],
								"url": {
									"raw": "{{base_url}}/api/v1/features/user/{{user_id}}/summary",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "features", "user", "{{user_id}}", "summary"]
								},
								"description": "Get a summarized view of key features for a user (engagement, cart behavior, purchase history, recency)"
							}
						},
						{
							"name": "Compute User Features (On-Demand)",
							"request": {
								"method": "POST",
								"header": [
									{"key": "X-API-Key", "value": "{{api_key}}"}
								],
								"url": {
									"raw": "{{base_url}}/api/v1/features/user/{{user_id}}/compute?ttl_days=7",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "features", "user", "{{user_id}}", "compute"],
									"query": [
										{"key": "ttl_days", "value": "7"}
									]
								},
								"description": "Compute features for a user on-demand. This queries ClickHouse and stores in Aerospike. Use sparingly - prefer background job for bulk computation."
							}
						}
					]
				}
			]
		},
		{
			"name": "ClickHouse (Debug)",
			"description": "Direct ClickHouse queries for debugging/verification",
			"item": [
				{
					"name": "Query - Count All Events",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "SELECT count() as total_events, uniqExact(user_id) as unique_users FROM events.all_events"
						},
						"url": {
							"raw": "{{clickhouse_url}}/?user=cartnudge&password=cartnudge_dev",
							"host": ["{{clickhouse_url}}"],
							"path": [""],
							"query": [
								{"key": "user", "value": "cartnudge"},
								{"key": "password", "value": "cartnudge_dev"}
							]
						},
						"description": "Count all events in ClickHouse"
					}
				},
				{
					"name": "Query - Events by User",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "SELECT * FROM events.all_events WHERE user_id = '{{user_id}}' ORDER BY event_timestamp DESC LIMIT 20 FORMAT Pretty"
						},
						"url": {
							"raw": "{{clickhouse_url}}/?user=cartnudge&password=cartnudge_dev",
							"host": ["{{clickhouse_url}}"],
							"path": [""],
							"query": [
								{"key": "user", "value": "cartnudge"},
								{"key": "password", "value": "cartnudge_dev"}
							]
						},
						"description": "Get recent events for a specific user"
					}
				},
				{
					"name": "Query - Cart Events",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "SELECT * FROM events.cart_events WHERE user_id = '{{user_id}}' ORDER BY event_timestamp DESC LIMIT 10 FORMAT Pretty"
						},
						"url": {
							"raw": "{{clickhouse_url}}/?user=cartnudge&password=cartnudge_dev",
							"host": ["{{clickhouse_url}}"],
							"path": [""],
							"query": [
								{"key": "user", "value": "cartnudge"},
								{"key": "password", "value": "cartnudge_dev"}
							]
						},
						"description": "Get cart events for a user"
					}
				},
				{
					"name": "Query - Page Events",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "SELECT * FROM events.page_events WHERE user_id = '{{user_id}}' ORDER BY event_timestamp DESC LIMIT 10 FORMAT Pretty"
						},
						"url": {
							"raw": "{{clickhouse_url}}/?user=cartnudge&password=cartnudge_dev",
							"host": ["{{clickhouse_url}}"],
							"path": [""],
							"query": [
								{"key": "user", "value": "cartnudge"},
								{"key": "password", "value": "cartnudge_dev"}
							]
						},
						"description": "Get page events for a user"
					}
				},
				{
					"name": "Query - Order Events",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "SELECT * FROM events.order_events WHERE user_id = '{{user_id}}' ORDER BY event_timestamp DESC LIMIT 10 FORMAT Pretty"
						},
						"url": {
							"raw": "{{clickhouse_url}}/?user=cartnudge&password=cartnudge_dev",
							"host": ["{{clickhouse_url}}"],
							"path": [""],
							"query": [
								{"key": "user", "value": "cartnudge"},
								{"key": "password", "value": "cartnudge_dev"}
							]
						},
						"description": "Get order events for a user"
					}
				},
				{
					"name": "Query - Daily Cart Metrics",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "SELECT * FROM events.mv_daily_cart_metrics WHERE project_id = '{{project_id}}' ORDER BY event_date DESC LIMIT 30 FORMAT Pretty"
						},
						"url": {
							"raw": "{{clickhouse_url}}/?user=cartnudge&password=cartnudge_dev",
							"host": ["{{clickhouse_url}}"],
							"path": [""],
							"query": [
								{"key": "user", "value": "cartnudge"},
								{"key": "password", "value": "cartnudge_dev"}
							]
						},
						"description": "Get daily aggregated cart metrics"
					}
				},
				{
					"name": "Query - Show Tables",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "SHOW TABLES FROM events"
						},
						"url": {
							"raw": "{{clickhouse_url}}/?user=cartnudge&password=cartnudge_dev",
							"host": ["{{clickhouse_url}}"],
							"path": [""],
							"query": [
								{"key": "user", "value": "cartnudge"},
								{"key": "password", "value": "cartnudge_dev"}
							]
						},
						"description": "List all tables in the events database"
					}
				}
			]
		},
		{
			"name": "Datablocks",
			"description": "Datablock management - predefined templates and custom datablocks for data modeling",
			"item": [
				{
					"name": "Templates",
					"item": [
						{
							"name": "List Predefined Templates",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/v1/datablocks/templates",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "datablocks", "templates"]
								},
								"description": "Get all available predefined datablock templates"
							}
						},
						{
							"name": "Get Template by Name",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/v1/datablocks/templates/users",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "datablocks", "templates", "users"]
								},
								"description": "Get a specific template. Options: users, products, cart_events, page_views, orders"
							}
						}
					]
				},
				{
					"name": "CRUD",
					"item": [
						{
							"name": "List Project Datablocks",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/v1/projects/{{project_id}}/datablocks?skip=0&limit=100",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "projects", "{{project_id}}", "datablocks"],
									"query": [
										{"key": "skip", "value": "0"},
										{"key": "limit", "value": "100"}
									]
								}
							}
						},
						{
							"name": "Create Custom Datablock",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"var jsonData = pm.response.json();",
											"if (jsonData._id) {",
											"    pm.collectionVariables.set('datablock_id', jsonData._id);",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{"key": "Content-Type", "value": "application/json"}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"name\": \"custom_events\",\n    \"display_name\": \"Custom Events\",\n    \"description\": \"Custom event tracking datablock\",\n    \"source_type\": \"event\",\n    \"icon\": \"database\",\n    \"schema_fields\": [\n        {\n            \"name\": \"event_id\",\n            \"type\": \"string\",\n            \"required\": true,\n            \"is_primary_key\": true\n        },\n        {\n            \"name\": \"user_id\",\n            \"type\": \"string\",\n            \"required\": true\n        },\n        {\n            \"name\": \"event_type\",\n            \"type\": \"string\",\n            \"required\": true\n        }\n    ]\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/v1/projects/{{project_id}}/datablocks",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "projects", "{{project_id}}", "datablocks"]
								}
							}
						},
						{
							"name": "Create from Template",
							"request": {
								"method": "POST",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/v1/projects/{{project_id}}/datablocks/from-template/users",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "projects", "{{project_id}}", "datablocks", "from-template", "users"]
								}
							}
						},
						{
							"name": "Get Datablock",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/v1/projects/{{project_id}}/datablocks/{{datablock_id}}",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "projects", "{{project_id}}", "datablocks", "{{datablock_id}}"]
								}
							}
						},
						{
							"name": "Update Datablock",
							"request": {
								"method": "PUT",
								"header": [
									{"key": "Content-Type", "value": "application/json"}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"description\": \"Updated description\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/v1/projects/{{project_id}}/datablocks/{{datablock_id}}",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "projects", "{{project_id}}", "datablocks", "{{datablock_id}}"]
								}
							}
						},
						{
							"name": "Delete Datablock",
							"request": {
								"method": "DELETE",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/v1/projects/{{project_id}}/datablocks/{{datablock_id}}",
									"host": ["{{base_url}}"],
									"path": ["api", "v1", "projects", "{{project_id}}", "datablocks", "{{datablock_id}}"]
								}
							}
						}
					]
				}
			]
		},
		{
			"name": "Pipelines",
			"description": "Pipeline management - event ingestion pipelines with webhooks",
			"item": [
				{
					"name": "List Pipelines",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/projects/{{project_id}}/pipelines?skip=0&limit=100",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "projects", "{{project_id}}", "pipelines"],
							"query": [
								{"key": "skip", "value": "0"},
								{"key": "limit", "value": "100"}
							]
						}
					}
				},
				{
					"name": "Create Pipeline",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"if (jsonData._id) {",
									"    pm.collectionVariables.set('pipeline_id', jsonData._id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{"key": "Content-Type", "value": "application/json"}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"User Behavior Pipeline\",\n    \"description\": \"Track user behavior events\",\n    \"category\": \"behavioral\",\n    \"events\": [\n        {\n            \"name\": \"add_to_cart\",\n            \"description\": \"Item added to cart\",\n            \"enabled\": true,\n            \"fields\": [\n                {\"name\": \"user_id\", \"type\": \"string\", \"required\": true},\n                {\"name\": \"product_id\", \"type\": \"string\", \"required\": true}\n            ]\n        }\n    ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/projects/{{project_id}}/pipelines",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "projects", "{{project_id}}", "pipelines"]
						}
					}
				},
				{
					"name": "Get Pipeline",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/projects/{{project_id}}/pipelines/{{pipeline_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "projects", "{{project_id}}", "pipelines", "{{pipeline_id}}"]
						}
					}
				},
				{
					"name": "Activate Pipeline",
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/projects/{{project_id}}/pipelines/{{pipeline_id}}/activate",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "projects", "{{project_id}}", "pipelines", "{{pipeline_id}}", "activate"]
						}
					}
				},
				{
					"name": "Get Webhook Info",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/projects/{{project_id}}/pipelines/{{pipeline_id}}/webhook",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "projects", "{{project_id}}", "pipelines", "{{pipeline_id}}", "webhook"]
						}
					}
				}
			]
		},
		{
			"name": "Deployments",
			"description": "Deployment orchestration - manage deployment buckets and execute deployments",
			"item": [
				{
					"name": "Create Deployment Bucket",
					"request": {
						"method": "POST",
						"header": [
							{"key": "Content-Type", "value": "application/json"}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"My Deployment\",\n    \"description\": \"Feature release\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/projects/{{project_id}}/deployment-buckets",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "projects", "{{project_id}}", "deployment-buckets"]
						}
					}
				},
				{
					"name": "List Buckets",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/projects/{{project_id}}/deployment-buckets",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "projects", "{{project_id}}", "deployment-buckets"]
						}
					}
				},
				{
					"name": "Get Active Bucket",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/projects/{{project_id}}/deployment-buckets/active",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "projects", "{{project_id}}", "deployment-buckets", "active"]
						}
					}
				},
				{
					"name": "Execute Deployment",
					"request": {
						"method": "POST",
						"header": [
							{"key": "Content-Type", "value": "application/json"}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"dry_run\": false\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/projects/{{project_id}}/deployment-buckets/{{bucket_id}}/deploy",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "projects", "{{project_id}}", "deployment-buckets", "{{bucket_id}}", "deploy"]
						}
					}
				},
				{
					"name": "List Deployment History",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/projects/{{project_id}}/deployments",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "projects", "{{project_id}}", "deployments"]
						}
					}
				}
			]
		},
		{
			"name": "Training Data",
			"description": "ML training data generation and management for purchase propensity model",
			"item": [
				{
					"name": "Generate Training Data",
					"request": {
						"method": "POST",
						"header": [
							{"key": "Content-Type", "value": "application/json"},
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"start_date\": \"2024-12-01\",\n    \"end_date\": \"2024-12-13\",\n    \"label_window_hours\": 24\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/training/purchase-propensity/generate",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "training", "purchase-propensity", "generate"]
						},
						"description": "Trigger training data generation for purchase propensity model. Runs in background."
					}
				},
				{
					"name": "Get Training Data Stats",
					"request": {
						"method": "GET",
						"header": [
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/training/purchase-propensity/stats",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "training", "purchase-propensity", "stats"]
						},
						"description": "Get statistics about training data (total samples, positive/negative counts, conversion rate)"
					}
				},
				{
					"name": "Get Training Data Summary by Date",
					"request": {
						"method": "GET",
						"header": [
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/training/purchase-propensity/summary?days=30",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "training", "purchase-propensity", "summary"],
							"query": [
								{"key": "days", "value": "30"}
							]
						},
						"description": "Get training data summary grouped by observation date"
					}
				},
				{
					"name": "Get Training Runs History",
					"request": {
						"method": "GET",
						"header": [
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/training/runs?limit=20",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "training", "runs"],
							"query": [
								{"key": "limit", "value": "20"}
							]
						},
						"description": "Get history of training data generation runs"
					}
				},
				{
					"name": "Export Training Data as CSV",
					"request": {
						"method": "GET",
						"header": [
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/training/purchase-propensity/export?limit=10000",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "training", "purchase-propensity", "export"],
							"query": [
								{"key": "limit", "value": "10000"}
							]
						},
						"description": "Export training data as CSV for model training"
					}
				},
				{
					"name": "Query Training Table (ClickHouse)",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "SELECT * FROM events.purchase_propensity_training WHERE project_id = '{{project_id}}' ORDER BY observation_timestamp DESC LIMIT 10 FORMAT Pretty"
						},
						"url": {
							"raw": "{{clickhouse_url}}/?user=cartnudge&password=cartnudge_dev",
							"host": ["{{clickhouse_url}}"],
							"path": [""],
							"query": [
								{"key": "user", "value": "cartnudge"},
								{"key": "password", "value": "cartnudge_dev"}
							]
						},
						"description": "Direct query to ClickHouse training table"
					}
				},
				{
					"name": "Query Training Summary View (ClickHouse)",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "SELECT * FROM events.v_training_data_summary ORDER BY observation_date DESC LIMIT 30"
						},
						"url": {
							"raw": "{{clickhouse_url}}/?user=cartnudge&password=cartnudge_dev",
							"host": ["{{clickhouse_url}}"],
							"path": [""],
							"query": [
								{"key": "user", "value": "cartnudge"},
								{"key": "password", "value": "cartnudge_dev"}
							]
						},
						"description": "Query training data summary view in ClickHouse"
					}
				}
			]
		},
		{
			"name": "E2E Test Flow",
			"description": "End-to-end test: API → Kafka → ClickHouse → Aerospike\n\nRun these in order, waiting 5-10 seconds between steps for processing.",
			"item": [
				{
					"name": "1. Send Cart Event",
					"request": {
						"method": "POST",
						"header": [
							{"key": "Content-Type", "value": "application/json"},
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"event_type\": \"cart.add\",\n    \"topic\": \"cart_events\",\n    \"data\": {\n        \"user_id\": \"e2e_test_user\",\n        \"session_id\": \"e2e_session\",\n        \"product_id\": \"TEST-PROD-001\",\n        \"quantity\": 2,\n        \"price\": 99.99,\n        \"cart_total\": 199.98\n    }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/events/ingest",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "events", "ingest"]
						},
						"description": "Step 1: Send a cart.add event to API"
					}
				},
				{
					"name": "2. Send Page View Event",
					"request": {
						"method": "POST",
						"header": [
							{"key": "Content-Type", "value": "application/json"},
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"event_type\": \"page.view\",\n    \"topic\": \"page_events\",\n    \"data\": {\n        \"user_id\": \"e2e_test_user\",\n        \"session_id\": \"e2e_session\",\n        \"page_url\": \"/products/TEST-PROD-001\",\n        \"page_type\": \"product\",\n        \"product_id\": \"TEST-PROD-001\",\n        \"duration_ms\": 15000\n    }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/events/ingest",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "events", "ingest"]
						},
						"description": "Step 2: Send a page.view event"
					}
				},
				{
					"name": "3. Check ClickHouse",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "SELECT event_type, event_timestamp, user_id FROM events.all_events WHERE user_id = 'e2e_test_user' ORDER BY event_timestamp DESC LIMIT 10 FORMAT Pretty"
						},
						"url": {
							"raw": "{{clickhouse_url}}/?user=cartnudge&password=cartnudge_dev",
							"host": ["{{clickhouse_url}}"],
							"path": [""],
							"query": [
								{"key": "user", "value": "cartnudge"},
								{"key": "password", "value": "cartnudge_dev"}
							]
						},
						"description": "Step 3: Verify events reached ClickHouse (wait 5s after step 2)"
					}
				},
				{
					"name": "4. Get All Feature Groups",
					"request": {
						"method": "GET",
						"header": [
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/features/user/e2e_test_user/groups",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "features", "user", "e2e_test_user", "groups"]
						},
						"description": "Step 4: Get all computed feature groups from Aerospike (wait 10-15s for aggregator)"
					}
				},
				{
					"name": "5. Get Cart Features Only",
					"request": {
						"method": "GET",
						"header": [
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/features/user/e2e_test_user/groups/cart",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "features", "user", "e2e_test_user", "groups", "cart"]
						},
						"description": "Step 5: Get just the cart feature group"
					}
				},
				{
					"name": "6. Get Flattened Features (ML-Ready)",
					"request": {
						"method": "GET",
						"header": [
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/features/user/e2e_test_user/flat",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "features", "user", "e2e_test_user", "flat"]
						},
						"description": "Step 6: Get all features flattened into a single dict for ML inference"
					}
				},
				{
					"name": "7. Get Feature Summary",
					"request": {
						"method": "GET",
						"header": [
							{"key": "X-API-Key", "value": "{{api_key}}"}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/features/user/e2e_test_user/summary",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "features", "user", "e2e_test_user", "summary"]
						},
						"description": "Step 7: Get a human-readable feature summary"
					}
				}
			]
		}
	]
}
